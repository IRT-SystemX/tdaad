

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Learning on a modified Ornstein–Uhlenbeck process &mdash; Topological Data Analysis for Anomaly Detection 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="📚 Technical docs" href="../tech_docs.html" />
    <link rel="prev" title="🧪 Tutorial" href="../tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Topological Data Analysis for Anomaly Detection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">📖 Guidelines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">🧪 Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Learning on a modified Ornstein–Uhlenbeck process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Topological-embedding-of-a-multiple-time-series">Topological embedding of a multiple time series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-persistence-diagram-transform">The persistence diagram transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-sliding-window-algorithm">The sliding window algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Vectorizing-topological-information">Vectorizing topological information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Anomaly-Detection-based-on-topological-features">Anomaly Detection based on topological features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tech_docs.html">📚 Technical docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory_overview.html">💡 Theory overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory_overview.html#references">📑 References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">🔄 Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generated/modules.html">tdaad</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Topological Data Analysis for Anomaly Detection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorial.html">🧪 Tutorial</a></li>
      <li class="breadcrumb-item active">Learning on a modified Ornstein–Uhlenbeck process</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/oua_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Learning-on-a-modified-Ornstein–Uhlenbeck-process">
<h1>Learning on a modified Ornstein–Uhlenbeck process<a class="headerlink" href="#Learning-on-a-modified-Ornstein–Uhlenbeck-process" title="Link to this heading"></a></h1>
<p>The Ornstein-Uhlenbeck process is an auto-regressive process of order 1, and can be understood as a random walk that can be used for modelling timeseries in applicative fields such as physics, biology or finance. We generate that process and disturb it at times with gaussian noise for demonstrating this component.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ornstein_uhlenbeck_anomaly</span><span class="p">(</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">noise_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">mean_reverting</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">anomaly_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">anomaly_duration</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
        <span class="n">anomaly_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">314</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">length</span><span class="p">,</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dt</span> <span class="o">/</span> <span class="n">anomaly_duration</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">target</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mean_reverting</span> <span class="o">*</span> <span class="n">dt</span><span class="p">),</span>
            <span class="n">noise_scale</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mf">.5</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">anomaly_freq</span><span class="p">:</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">target</span> <span class="o">+=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">anomaly_scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pre_X</span><span class="p">,</span> <span class="n">pre_y</span> <span class="o">=</span> <span class="n">ornstein_uhlenbeck_anomaly</span><span class="p">(</span>
    <span class="n">t</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">noise_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">mean_reverting</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">anomaly_freq</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
    <span class="n">anomaly_duration</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
    <span class="n">anomaly_scale</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pre_X</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pre_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pre_y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_3_1.png" src="../_images/notebooks_oua_tutorial_3_1.png" />
</div>
</div>
</section>
<section id="Topological-embedding-of-a-multiple-time-series">
<h1>Topological embedding of a multiple time series<a class="headerlink" href="#Topological-embedding-of-a-multiple-time-series" title="Link to this heading"></a></h1>
<section id="The-persistence-diagram-transform">
<h2>The persistence diagram transform<a class="headerlink" href="#The-persistence-diagram-transform" title="Link to this heading"></a></h2>
<p>A major tool from the Topological Data Analysis (TDA) field is the persistence diagram, that summarizes information in the form of a set of points in <span class="math notranslate nohighlight">\(\mathbf{R}^2\)</span>.</p>
<p>For instance if we try to extract topological information on the entire multiple timeseries <code class="docutils literal notranslate"><span class="pre">X</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tdaad.topological_embedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistenceDiagramTransformer</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gudhi</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_persistence_diagram</span>
<span class="n">global_pdiagram</span> <span class="o">=</span> <span class="n">PersistenceDiagramTransformer</span><span class="p">(</span><span class="n">reformatting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_persistence_diagram</span><span class="p">(</span><span class="n">global_pdiagram</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[03-07 15:27:11] {/home/martin.royer/SVN/tdaad/tdaad/twe_logger.py:104} INFO - Logger: name: twe_logger, handlers: [&lt;StreamHandler stdout (DEBUG)&gt;]
[03-07 15:27:11] {/home/martin.royer/SVN/tdaad/tdaad/twe_logger.py:104} INFO - Logger: name: twe_logger, handlers: [&lt;StreamHandler stdout (DEBUG)&gt;]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Persistence diagram&#39;}, xlabel=&#39;Birth&#39;, ylabel=&#39;Death&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_7_2.png" src="../_images/notebooks_oua_tutorial_7_2.png" />
</div>
</div>
</section>
<section id="The-sliding-window-algorithm">
<h2>The sliding window algorithm<a class="headerlink" href="#The-sliding-window-algorithm" title="Link to this heading"></a></h2>
<p>In order to capture local information and detect potential anomalies, we cut the multiple timeseries in regular chunks or <em>windows</em>, and apply the Persistence Diagram Transform on each window. Therefore we transform the original time series into a persistence diagram time series, for instance if we cut it in three parts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">swv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">)[::</span><span class="mi">200</span><span class="p">,</span> <span class="p">:]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">swv</span><span class="p">:</span>
    <span class="n">pdiagram</span> <span class="o">=</span> <span class="n">PersistenceDiagramTransformer</span><span class="p">(</span><span class="n">reformatting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">window</span><span class="p">])</span>
    <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">window</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_persistence_diagram</span><span class="p">(</span><span class="n">pdiagram</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_0.png" src="../_images/notebooks_oua_tutorial_10_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_1.png" src="../_images/notebooks_oua_tutorial_10_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_2.png" src="../_images/notebooks_oua_tutorial_10_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_3.png" src="../_images/notebooks_oua_tutorial_10_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_4.png" src="../_images/notebooks_oua_tutorial_10_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_10_5.png" src="../_images/notebooks_oua_tutorial_10_5.png" />
</div>
</div>
</section>
<section id="Vectorizing-topological-information">
<h2>Vectorizing topological information<a class="headerlink" href="#Vectorizing-topological-information" title="Link to this heading"></a></h2>
<p>These persistence diagrams carry the information associated to a homological dimension, but the number of these points cannot be predicted generally, and therefore persistence diagrams need to be vectorized in order to integrate a classical machine learning pipeline. This is done using the <code class="docutils literal notranslate"><span class="pre">Atol</span></code> and <code class="docutils literal notranslate"><span class="pre">Archipelago</span></code> tools from the Gudhi library, and the <code class="docutils literal notranslate"><span class="pre">PersistenceDiagramTransformer</span></code> is integrated into a larger pipeline making use of these tools.</p>
<p>Selecting a number of encoding points by dimension, <code class="docutils literal notranslate"><span class="pre">n_centers_by_dim</span></code>, this results in a <em>representation method</em> we call <code class="docutils literal notranslate"><span class="pre">TopologicalEmbedding</span></code>.</p>
<p>Now we apply the procedure from before with the sliding window algorithm. So instead of a single embedding vector, we get a vector for each window in the timeseries <code class="docutils literal notranslate"><span class="pre">X</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tdaad.topological_embedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">TopologicalEmbedding</span>

<span class="n">embedder</span> <span class="o">=</span> <span class="n">TopologicalEmbedding</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_centers_by_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">embedding</span> <span class="o">=</span> <span class="n">embedder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">embedding</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Atol0__feat-1</th>
      <th>Atol0__feat-2</th>
      <th>Atol1__feat-1</th>
      <th>Atol1__feat-2</th>
      <th>Atol2__feat-1</th>
      <th>Atol2__feat-2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-01 00:00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 01:00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 02:00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 03:00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 04:00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-02-11 11:00:00</th>
      <td>8.259610</td>
      <td>7.100526</td>
      <td>0.267054</td>
      <td>2.686448</td>
      <td>0.041066</td>
      <td>0.303877</td>
    </tr>
    <tr>
      <th>2021-02-11 12:00:00</th>
      <td>8.314042</td>
      <td>6.872867</td>
      <td>0.453548</td>
      <td>2.640181</td>
      <td>0.082132</td>
      <td>0.607754</td>
    </tr>
    <tr>
      <th>2021-02-11 13:00:00</th>
      <td>8.368473</td>
      <td>6.645208</td>
      <td>0.640042</td>
      <td>2.593914</td>
      <td>0.123198</td>
      <td>0.911631</td>
    </tr>
    <tr>
      <th>2021-02-11 14:00:00</th>
      <td>8.422904</td>
      <td>6.417550</td>
      <td>0.826536</td>
      <td>2.547647</td>
      <td>0.164264</td>
      <td>1.215508</td>
    </tr>
    <tr>
      <th>2021-02-11 15:00:00</th>
      <td>8.477336</td>
      <td>6.189891</td>
      <td>1.013029</td>
      <td>2.501380</td>
      <td>0.205330</td>
      <td>1.519385</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 6 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">embedding</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">embedding</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;],
      dtype=object)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_15_1.png" src="../_images/notebooks_oua_tutorial_15_1.png" />
</div>
</div>
</section>
</section>
<section id="Anomaly-Detection-based-on-topological-features">
<h1>Anomaly Detection based on topological features<a class="headerlink" href="#Anomaly-Detection-based-on-topological-features" title="Link to this heading"></a></h1>
<p>What is left is to analyze those topological features for detecting anomaly. We use a procedure from <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> called <code class="docutils literal notranslate"><span class="pre">EllipticEnvelope</span></code> based on a robust covariance estimation procedure, that estimates the topological mean and covariance of the vectors and use these to produce the associated mahalanobis distance. Once this distance is defined, an anomaly score is simply derived from it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tdaad.anomaly_detectors</span><span class="w"> </span><span class="kn">import</span> <span class="n">TopologicalAnomalyDetector</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">TopologicalAnomalyDetector</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_centers_by_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tda_max_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">anomaly_score</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">anomaly_score</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score-exhaustive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-01 00:00:00</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 01:00:00</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 02:00:00</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 03:00:00</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2021-01-01 04:00:00</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-02-11 11:00:00</th>
      <td>-2.223949</td>
    </tr>
    <tr>
      <th>2021-02-11 12:00:00</th>
      <td>-2.123167</td>
    </tr>
    <tr>
      <th>2021-02-11 13:00:00</th>
      <td>-2.022384</td>
    </tr>
    <tr>
      <th>2021-02-11 14:00:00</th>
      <td>-1.921602</td>
    </tr>
    <tr>
      <th>2021-02-11 15:00:00</th>
      <td>-1.820820</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 1 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">anomaly_score</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&lt;Axes: &gt;, &lt;Axes: &gt;], dtype=object)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_19_1.png" src="../_images/notebooks_oua_tutorial_19_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_oua_tutorial_19_2.png" src="../_images/notebooks_oua_tutorial_19_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../tutorial.html" class="btn btn-neutral float-left" title="🧪 Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tech_docs.html" class="btn btn-neutral float-right" title="📚 Technical docs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Martin Royer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>